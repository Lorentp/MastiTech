{{>global/headerlogged}}

<nav>
    <a href="/home" class="link-button">Volver al inicio</a>
    <a href="/en-tratamiento" class="link-button">Animales en tratamiento</a>
    <a href="/liberar-leche" class="link-button">Animales para liberar</a>
    <a href="/cultivos" class="link-button">Cultivos</a>
</nav>

<h1>Vacas en Período de Descarte de Leche</h1>
<p class="subtitle">Tratamientos terminados que siguen descartando leche.</p>

{{#if milkDiscardCows.length}}
    <div class="discarding-milk-cards">
        {{#each milkDiscardCows}}
            <div class="finished-milk-discard-card discarding-milk-card">
                <div class="card-header">
                    <h3>{{this.name}}</h3>
                    <span class="events-badge">Eventos (Mastitis): {{this.events}}</span>
                </div>

                <div class="card-body">
                    <p><strong>Tratamiento:</strong> {{this.lastTreatmentSnapshot.title}}</p>
                    <p><strong>Ubres tratadas:</strong> 
                        {{#if this.lastTreatmentEntry.udders.length}}
                            {{join this.lastTreatmentEntry.udders ", "}}
                        {{else}}
                            No especificado
                        {{/if}}
                    </p>
                    <p><strong>Inicio tratamiento:</strong> {{formatDate this.lastTreatmentEntry.startDate}}</p>
                    <p><strong>Turno de inicio:</strong> {{formatTurn this.lastTreatmentEntry.startTurn}}</p>
                    <p><strong>Finalizó tratamiento:</strong> {{formatDate this.lastTreatmentEntry.endDate}}</p>
                    <div class="discard-highlight">
                        <p>
                            <strong>Fin descarte leche:</strong>
                            <span class="highlighted-date">{{formatDate this.endDateDiscardMilk}}</span>
                        </p>
                        <p class="remaining-turns">
                            Turnos restantes: 
                            <strong class="{{#if (lt this.remainingDiscardTurns 3)}}urgent{{else}}normal{{/if}}">
                                {{this.remainingDiscardTurns}}
                            </strong>
                        </p>
                    </div>
                    <p class="current-turn-info">
                        Turno actual del rodeo: <strong>{{this.currentTurn}}</strong>
                    </p>
                </div>
            </div>
        {{/each}}
    </div>
{{else}}
    <div class="form-container">
        <p class="no-cows-message">
            ¡Excelente! No hay vacas en período de descarte de leche actualmente.
        </p>
    </div>
{{/if}}
