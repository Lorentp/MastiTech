{{>global/headerlogged}}

<nav>
    <a href="/home" class="link-button">Volver al inicio</a>
    <a href="/en-tratamiento" class="link-button">Animales en tratamiento</a>
    <a href="/descarte-leche" class="link-button">Animales en descarte leche</a>
    <a href="/liberar-leche" class="link-button">Animales para liberar</a>
</nav>

<div class="form-container">
    <h2>Buscar animales</h2>
    <div class="filter-row">
        <label for="culture-search">Buscar por caravana:</label>
        <input type="text" id="culture-search" placeholder="Ej: 1234">
    </div>
    <div class="filter-row">
        <label for="culture-events-filter">Filtrar por eventos (cultivos):</label>
        <select id="culture-events-filter">
            <option value="any">Todos</option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="10plus">10+</option>
        </select>
    </div>
</div>

<h1>Cultivos en curso</h1>

<h2>Esperando resultado</h2>
{{#if pending.length}}
    <div class="treated-container">
    {{#each pending}}
        <div class="finished-milk-discard-card" data-name="{{this.name}}" data-events="{{this.eventsCount}}">
            <div class="card-header">
                <h3>{{this.name}}</h3>
                <span class="events-badge">Eventos (cultivos): {{this.eventsCount}}</span>
            </div>
            <div class="card-body">
                <p><strong>Resultado actual:</strong> {{this.status}}</p>
                {{#if this.latestEvent}}
                <p><strong>Evento a actualizar:</strong> {{formatDate this.latestEvent.recordedAt}}
                    {{#if this.latestEvent.udders.length}} · Ubres: {{join this.latestEvent.udders ", "}}{{/if}}
                </p>
                {{/if}}
                <div class="culture-result-form">
                    <label>Actualizar resultado:</label>
                    <select class="culture-result-select" data-id="{{this._id}}">
                        <option value="pendiente">Pendiente</option>
                        <option value="negativo">Negativo</option>
                        <option value="sin desarrollo">Sin desarrollo</option>
                        <option value="positivo">Positivo</option>
                    </select>
                    <button class="link-button culture-result-save" data-id="{{this._id}}">Guardar</button>
                    <button class="link-button danger culture-delete" data-id="{{this._id}}">Eliminar</button>
                </div>
                {{#if (lt 1 this.eventsCount)}}
                <div class="events-breakdown">
                    <p><strong>Eventos (detallados):</strong></p>
                    {{#each this.eventsDetailed}}
                        <p>
                            - {{this.result}}:
                            {{formatDate this.recordedAt}}
                            {{#if this.udders.length}}
                                · Ubres: {{join this.udders ", "}}
                            {{/if}}
                        </p>
                    {{/each}}
                </div>
                {{/if}}
            </div>
        </div>
    {{/each}}
    </div>
{{else}}
    <p class="no-cows-message">No hay cultivos pendientes.</p>
{{/if}}

<h2>Con resultado</h2>
{{#if finished.length}}
    <div class="treated-container">
    {{#each finished}}
        <div class="finished-milk-discard-card" data-name="{{this.name}}" data-events="{{this.eventsCount}}">
            <div class="card-header">
                <h3>{{this.name}}</h3>
                <span class="events-badge">Eventos (cultivos): {{this.eventsCount}}</span>
            </div>
            <div class="card-body">             
                {{#if (lt 1 this.eventsCount)}}
                <div class="events-breakdown">
                    <p><strong>Eventos (detallados):</strong></p>
                    {{#each this.eventsDetailed}}
                        <p>
                            - {{this.result}}:
                            {{formatDate this.recordedAt}}
                            {{#if this.udders.length}}
                                · Ubres: {{join this.udders ", "}}
                            {{/if}}
                        </p>
                    {{/each}}
                </div>
                    <button class="link-button danger culture-delete" data-id="{{this._id}}">Eliminar</button>
                {{/if}}
            </div>
        </div>
    {{/each}}
    </div>
{{else}}
    <p class="no-cows-message">Todavia no hay cultivos con resultado.</p>
{{/if}}

<script src="/js/enfermery/cultureResults.js"></script>
<script src="/js/enfermery/cultureFilters.js"></script>
